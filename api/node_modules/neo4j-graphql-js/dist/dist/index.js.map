{"version":3,"sources":["../index.js"],"names":["Object","defineProperty","exports","value","neo4jgraphql","undefined","_stringify","require","_stringify2","_interopRequireDefault","_objectWithoutProperties2","_objectWithoutProperties3","_regenerator","_regenerator2","_asyncToGenerator2","_asyncToGenerator3","_ref","default","mark","_callee","object","params","context","resolveInfo","debug","arguments","length","query","session","result","wrap","_callee$","_context","prev","next","_utils","isMutation","cypherMutation","isAddRelationshipMutation","cypherQuery","console","log","driver","run","sent","abrupt","extractQueryResult","returnType","stop","_x2","_x3","_x4","_x5","apply","augmentSchema","_filter","_filter2","_selections","_augmentSchema","obj","__esModule","_ref2","_ref2$first","first","_ref2$offset","offset","_id","otherParams","_typeIdentifiers","typeIdentifiers","typeName","variableName","schemaType","schema","getType","filteredFieldNodes","fieldNodes","n","name","fieldName","selections","extractSelections","selectionSet","fragments","argString","replace","idWherePredicate","outerSkipLimit","queryTypeCypherDirective","getQueryType","getFields","astNode","directives","filter","x","cypherQueryArg","buildCypherSelection","initial","_ref3","_ref3$first","_ref3$offset","_typeIdentifiers2","operation","mutationTypeCypherDirective","getMutationType","startsWith","mutationMeta","relationshipNameArg","fromTypeArg","toTypeArg","e","Error","fromType","toType","fromVar","lowFirstLetter","toVar","relationshipName","fromParam","substr","toParam","_query","mutationSchema","addMutationsToSchema"],"mappings":"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","file":"index.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.neo4jgraphql = undefined;\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');\n\nvar _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);\n\nvar _regenerator = require('babel-runtime/regenerator');\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');\n\nvar _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);\n\nvar neo4jgraphql = exports.neo4jgraphql = function () {\n  var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee(object, params, context, resolveInfo) {\n    var debug = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n    var query, session, result;\n    return _regenerator2.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            query = void 0;\n\n\n            if ((0, _utils.isMutation)(resolveInfo)) {\n              query = cypherMutation(params, context, resolveInfo);\n              if ((0, _utils.isAddRelationshipMutation)(resolveInfo)) {\n                //params = fixParamsForAddRelationshipMutation(params, resolveInfo);\n              } else {\n                params = { params: params };\n              }\n            } else {\n              query = cypherQuery(params, context, resolveInfo);\n            }\n\n            if (debug) {\n              console.log(query);\n              console.log(params);\n            }\n\n            session = context.driver.session();\n            _context.next = 6;\n            return session.run(query, params);\n\n          case 6:\n            result = _context.sent;\n            return _context.abrupt('return', (0, _utils.extractQueryResult)(result, resolveInfo.returnType));\n\n          case 8:\n          case 'end':\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function neo4jgraphql(_x2, _x3, _x4, _x5) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nexports.cypherQuery = cypherQuery;\nexports.cypherMutation = cypherMutation;\nexports.augmentSchema = augmentSchema;\n\nvar _filter = require('lodash/filter');\n\nvar _filter2 = _interopRequireDefault(_filter);\n\nvar _utils = require('./utils');\n\nvar _selections = require('./selections');\n\nvar _augmentSchema = require('./augmentSchema');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction cypherQuery(_ref2, context, resolveInfo) {\n  var _ref2$first = _ref2.first,\n      first = _ref2$first === undefined ? -1 : _ref2$first,\n      _ref2$offset = _ref2.offset,\n      offset = _ref2$offset === undefined ? 0 : _ref2$offset,\n      _id = _ref2._id,\n      otherParams = (0, _objectWithoutProperties3.default)(_ref2, ['first', 'offset', '_id']);\n\n  var _typeIdentifiers = (0, _utils.typeIdentifiers)(resolveInfo.returnType),\n      typeName = _typeIdentifiers.typeName,\n      variableName = _typeIdentifiers.variableName;\n\n  var schemaType = resolveInfo.schema.getType(typeName);\n\n  var filteredFieldNodes = (0, _filter2.default)(resolveInfo.fieldNodes, function (n) {\n    return n.name.value === resolveInfo.fieldName;\n  });\n\n  // FIXME: how to handle multiple fieldNode matches\n  var selections = (0, _utils.extractSelections)(filteredFieldNodes[0].selectionSet.selections, resolveInfo.fragments);\n\n  // FIXME: support IN for multiple values -> WHERE\n  var argString = (0, _stringify2.default)(otherParams).replace(/\\\"([^(\\\")\"]+)\\\":/g, '$1:');\n\n  var idWherePredicate = typeof _id !== 'undefined' ? 'WHERE ID(' + variableName + ')=' + _id + ' ' : '';\n  var outerSkipLimit = 'SKIP ' + offset + (first > -1 ? ' LIMIT ' + first : '');\n\n  var query = void 0;\n\n  //TODO: wrap in try catch\n  var queryTypeCypherDirective = resolveInfo.schema.getQueryType().getFields()[resolveInfo.fieldName].astNode.directives.filter(function (x) {\n    return x.name.value === 'cypher';\n  })[0];\n\n  if (queryTypeCypherDirective) {\n    // QueryType with a @cypher directive\n    var cypherQueryArg = queryTypeCypherDirective.arguments.filter(function (x) {\n      return x.name.value === 'statement';\n    })[0];\n\n    query = 'WITH apoc.cypher.runFirstColumn(\"' + cypherQueryArg.value.value + '\", ' + argString + ', True) AS x UNWIND x AS ' + variableName + '\\n    RETURN ' + variableName + ' {' + (0, _selections.buildCypherSelection)({\n      initial: '',\n      selections: selections,\n      variableName: variableName,\n      schemaType: schemaType,\n      resolveInfo: resolveInfo\n    }) + '} AS ' + variableName + ' ' + outerSkipLimit;\n  } else {\n    // No @cypher directive on QueryType\n    query = 'MATCH (' + variableName + ':' + typeName + ' ' + argString + ') ' + idWherePredicate + (\n    // ${variableName} { ${selection} } as ${variableName}`;\n    'RETURN ' + variableName + ' {' + (0, _selections.buildCypherSelection)({\n      initial: '',\n      selections: selections,\n      variableName: variableName,\n      schemaType: schemaType,\n      resolveInfo: resolveInfo\n    }) + '} AS ' + variableName + ' ' + outerSkipLimit);\n  }\n\n  return query;\n}\n\nfunction cypherMutation(_ref3, context, resolveInfo) {\n  var _ref3$first = _ref3.first,\n      first = _ref3$first === undefined ? -1 : _ref3$first,\n      _ref3$offset = _ref3.offset,\n      offset = _ref3$offset === undefined ? 0 : _ref3$offset,\n      _id = _ref3._id,\n      otherParams = (0, _objectWithoutProperties3.default)(_ref3, ['first', 'offset', '_id']);\n\n  // FIXME: lots of duplication here with cypherQuery, extract into util module\n\n  var _typeIdentifiers2 = (0, _utils.typeIdentifiers)(resolveInfo.returnType),\n      typeName = _typeIdentifiers2.typeName,\n      variableName = _typeIdentifiers2.variableName;\n\n  var schemaType = resolveInfo.schema.getType(typeName);\n\n  var filteredFieldNodes = (0, _filter2.default)(resolveInfo.fieldNodes, function (n) {\n    return n.name.value === resolveInfo.fieldName;\n  });\n\n  // FIXME: how to handle multiple fieldNode matches\n  var selections = (0, _utils.extractSelections)(filteredFieldNodes[0].selectionSet.selections, resolveInfo.fragments);\n\n  if (selections.length === 0) {\n    // FIXME: why aren't the selections found in the filteredFieldNode?\n    selections = (0, _utils.extractSelections)(resolveInfo.operation.selectionSet.selections, resolveInfo.fragments);\n  }\n\n  // FIXME: support IN for multiple values -> WHERE\n  var argString = (0, _stringify2.default)(otherParams).replace(/\\\"([^(\\\")\"]+)\\\":/g, '$1:');\n\n  var idWherePredicate = typeof _id !== 'undefined' ? 'WHERE ID(' + variableName + ')=' + _id + ' ' : '';\n  var outerSkipLimit = 'SKIP ' + offset + (first > -1 ? ' LIMIT ' + first : '');\n\n  var query = void 0;\n  var mutationTypeCypherDirective = resolveInfo.schema.getMutationType().getFields()[resolveInfo.fieldName].astNode.directives.filter(function (x) {\n    return x.name.value === 'cypher';\n  })[0];\n\n  if (mutationTypeCypherDirective) {\n    var cypherQueryArg = mutationTypeCypherDirective.arguments.filter(function (x) {\n      return x.name.value === 'statement';\n    })[0];\n\n    query = 'CALL apoc.cypher.doIt(\"' + cypherQueryArg.value.value + '\", ' + argString + ') YIELD value\\n    WITH apoc.map.values(value, [keys(value)[0]])[0] AS ' + variableName + '\\n    RETURN ' + variableName + ' {' + (0, _selections.buildCypherSelection)({\n      initial: '',\n      selections: selections,\n      variableName: variableName,\n      schemaType: schemaType,\n      resolveInfo: resolveInfo\n    }) + '} AS ' + variableName + ' ' + outerSkipLimit;\n  } else if (resolveInfo.fieldName.startsWith('Create') || resolveInfo.fieldName.startsWith('create')) {\n    // CREATE node\n    // TODO: handle for create relationship\n    // TODO: update / delete\n    // TODO: augment schema\n    query = 'CREATE (' + variableName + ':' + typeName + ') ';\n    query += 'SET ' + variableName + ' = $params ';\n    //query += `RETURN ${variable}`;\n    query += 'RETURN ' + variableName + ' {' + (0, _selections.buildCypherSelection)({\n      initial: '',\n      selections: selections,\n      variableName: variableName,\n      schemaType: schemaType,\n      resolveInfo: resolveInfo\n    });\n    query += '} AS ' + variableName;\n  } else if (resolveInfo.fieldName.startsWith('Add') || resolveInfo.fieldName.startsWith('add')) {\n    var mutationMeta = void 0,\n        relationshipNameArg = void 0,\n        fromTypeArg = void 0,\n        toTypeArg = void 0;\n\n    try {\n      mutationMeta = resolveInfo.schema.getMutationType().getFields()[resolveInfo.fieldName].astNode.directives.filter(function (x) {\n        return x.name.value === 'MutationMeta';\n      })[0];\n    } catch (e) {\n      throw new Error('Missing required MutationMeta directive on add relationship directive');\n    }\n\n    try {\n      relationshipNameArg = mutationMeta.arguments.filter(function (x) {\n        return x.name.value === 'relationship';\n      })[0];\n\n      fromTypeArg = mutationMeta.arguments.filter(function (x) {\n        return x.name.value === 'from';\n      })[0];\n\n      toTypeArg = mutationMeta.arguments.filter(function (x) {\n        return x.name.value === 'to';\n      })[0];\n    } catch (e) {\n      throw new Error('Missing required argument in MutationMeta directive (relationship, from, or to)');\n    }\n    //TODO: need to handle one-to-one and one-to-many\n\n    var fromType = fromTypeArg.value.value,\n        toType = toTypeArg.value.value,\n        fromVar = (0, _utils.lowFirstLetter)(fromType),\n        toVar = (0, _utils.lowFirstLetter)(toType),\n        relationshipName = relationshipNameArg.value.value,\n        fromParam = resolveInfo.schema.getMutationType().getFields()[resolveInfo.fieldName].astNode.arguments[0].name.value.substr(fromVar.length),\n        toParam = resolveInfo.schema.getMutationType().getFields()[resolveInfo.fieldName].astNode.arguments[1].name.value.substr(toVar.length);\n\n    var _query = 'MATCH (' + fromVar + ':' + fromType + ' {' + fromParam + ': $' + resolveInfo.schema.getMutationType().getFields()[resolveInfo.fieldName].astNode.arguments[0].name.value + '})\\n       MATCH (' + toVar + ':' + toType + ' {' + toParam + ': $' + resolveInfo.schema.getMutationType().getFields()[resolveInfo.fieldName].astNode.arguments[1].name.value + '})\\n      CREATE (' + fromVar + ')-[:' + relationshipName + ']->(' + toVar + ')\\n      RETURN ' + fromVar + ' {' + (0, _selections.buildCypherSelection)({\n      initial: '',\n      selections: selections,\n      variableName: variableName,\n      schemaType: schemaType,\n      resolveInfo: resolveInfo\n    }) + '} AS ' + fromVar + ';';\n\n    return _query;\n  } else {\n    // throw error - don't know how to handle this type of mutation\n    throw new Error('Mutation does not follow naming convention.');\n  }\n  return query;\n}\n\nfunction augmentSchema(schema) {\n  var mutationSchema = (0, _augmentSchema.addMutationsToSchema)(schema);\n\n  return mutationSchema;\n}"]}